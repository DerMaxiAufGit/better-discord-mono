---
phase: 04-ui-polish-production-readiness
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/loading/ConversationListSkeleton.tsx
  - frontend/src/components/loading/MessageListSkeleton.tsx
  - frontend/src/components/loading/ContactListSkeleton.tsx
  - frontend/src/lib/toast.ts
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Skeleton components render animated placeholders matching real content layout"
    - "Sonner Toaster is mounted in App root"
    - "toast helper functions are available for import"
  artifacts:
    - path: "frontend/src/components/loading/ConversationListSkeleton.tsx"
      provides: "Skeleton for conversation list"
      exports: ["ConversationListSkeleton"]
    - path: "frontend/src/components/loading/MessageListSkeleton.tsx"
      provides: "Skeleton for message list"
      exports: ["MessageListSkeleton"]
    - path: "frontend/src/components/loading/ContactListSkeleton.tsx"
      provides: "Skeleton for contact list"
      exports: ["ContactListSkeleton"]
    - path: "frontend/src/lib/toast.ts"
      provides: "Toast notification wrapper"
      exports: ["toast", "showError", "showSuccess"]
  key_links:
    - from: "frontend/src/App.tsx"
      to: "sonner"
      via: "Toaster component mount"
      pattern: "<Toaster"
---

<objective>
Create skeleton loading components and set up toast notification system.

Purpose: Provide loading feedback components and error notification infrastructure for the app.
Output: Three skeleton components for lists and Sonner toast integration.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-ui-polish-production-readiness/04-RESEARCH.md
@frontend/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skeleton loading components</name>
  <files>
    frontend/src/components/loading/ConversationListSkeleton.tsx
    frontend/src/components/loading/MessageListSkeleton.tsx
    frontend/src/components/loading/ContactListSkeleton.tsx
  </files>
  <action>
    Create skeleton components using react-loading-skeleton.

    1. ConversationListSkeleton.tsx:
       - Show 6 skeleton items (avatar circle + two text lines)
       - Use SkeletonTheme for dark mode support
       - Match ConversationList item layout: 48px circle avatar, 60% width name, 80% width preview

    2. MessageListSkeleton.tsx:
       - Show alternating left/right aligned message skeletons (8 items)
       - Left messages: smaller width (40-60%)
       - Right messages: smaller width (50-70%), right-aligned
       - Vary heights slightly for natural look

    3. ContactListSkeleton.tsx:
       - Show 8 skeleton items (avatar + name + status indicator)
       - Match ContactsPage contact item layout

    Pattern from RESEARCH.md:
    ```typescript
    import Skeleton, { SkeletonTheme } from 'react-loading-skeleton'
    import 'react-loading-skeleton/dist/skeleton.css'

    function ConversationListSkeleton() {
      return (
        <SkeletonTheme baseColor="#202020" highlightColor="#444">
          <div className="space-y-4 p-4">
            {Array(6).fill(0).map((_, i) => (
              <div key={i} className="flex items-center gap-3">
                <Skeleton circle width={48} height={48} />
                <div className="flex-1">
                  <Skeleton width="60%" height={20} />
                  <Skeleton width="80%" height={16} className="mt-2" />
                </div>
              </div>
            ))}
          </div>
        </SkeletonTheme>
      )
    }
    ```

    Important: Use CSS variables or detect theme for proper dark/light mode colors:
    - Light mode: baseColor="#e0e0e0" highlightColor="#f5f5f5"
    - Dark mode: baseColor="#202020" highlightColor="#444"

    Use next-themes useTheme hook to detect current theme.
  </action>
  <verify>TypeScript compiles: cd frontend && npx tsc --noEmit</verify>
  <done>Three skeleton components created matching actual list layouts</done>
</task>

<task type="auto">
  <name>Task 2: Create toast utility wrapper</name>
  <files>frontend/src/lib/toast.ts</files>
  <action>
    Create toast notification utilities at frontend/src/lib/toast.ts.

    Re-export sonner's toast with app-specific helpers:

    ```typescript
    import { toast as sonnerToast } from 'sonner'

    // Re-export base toast
    export const toast = sonnerToast

    // Convenience helpers with consistent styling
    export function showSuccess(message: string) {
      sonnerToast.success(message)
    }

    export function showError(message: string, options?: { action?: { label: string; onClick: () => void } }) {
      sonnerToast.error(message, options)
    }

    export function showInfo(message: string) {
      sonnerToast.info(message)
    }

    // For API errors with retry
    export function showApiError(message: string, retryFn?: () => void) {
      sonnerToast.error(message, retryFn ? {
        action: { label: 'Retry', onClick: retryFn }
      } : undefined)
    }

    // For promise-based operations
    export function showPromise<T>(
      promise: Promise<T>,
      messages: { loading: string; success: string; error: string }
    ) {
      return sonnerToast.promise(promise, messages)
    }
    ```
  </action>
  <verify>TypeScript compiles: cd frontend && npx tsc --noEmit</verify>
  <done>toast.ts exports toast and helper functions</done>
</task>

<task type="auto">
  <name>Task 3: Mount Toaster in App root</name>
  <files>frontend/src/App.tsx</files>
  <action>
    Add Sonner Toaster component to App.tsx.

    1. Import { Toaster } from 'sonner'
    2. Add Toaster component inside the ThemeProvider but outside Routes
    3. Configure Toaster:
       - position="top-center" (good for mobile)
       - visibleToasts={3} (prevent toast fatigue)
       - closeButton (allow manual dismiss)
       - toastOptions with duration: 4000

    Example placement:
    ```tsx
    import { Toaster } from 'sonner'

    function App() {
      return (
        <ThemeProvider ...>
          <Toaster
            position="top-center"
            visibleToasts={3}
            closeButton
            toastOptions={{ duration: 4000 }}
          />
          <BrowserRouter>
            ...
          </BrowserRouter>
        </ThemeProvider>
      )
    }
    ```

    Note: Sonner auto-detects dark mode via prefers-color-scheme or can be configured with theme prop.
  </action>
  <verify>cd frontend && npm run build (compiles successfully)</verify>
  <done>Toaster mounted in App.tsx with proper configuration</done>
</task>

</tasks>

<verification>
1. cd frontend && npx tsc --noEmit (no type errors)
2. grep -l "Skeleton" frontend/src/components/loading/*.tsx (all 3 files exist)
3. grep -l "Toaster" frontend/src/App.tsx (Toaster mounted)
4. grep -l "export.*toast" frontend/src/lib/toast.ts (exports exist)
</verification>

<success_criteria>
- Three skeleton components created with proper layout
- Toast utility provides showSuccess, showError, showApiError helpers
- Toaster mounted in App root
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish-production-readiness/04-02-SUMMARY.md`
</output>
