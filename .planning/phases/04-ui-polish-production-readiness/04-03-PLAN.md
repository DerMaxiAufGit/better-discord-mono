---
phase: 04-ui-polish-production-readiness
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/components/mobile/BottomNav.tsx
  - frontend/src/components/layout/AppShell.tsx
autonomous: true

must_haves:
  truths:
    - "Bottom navigation shows on mobile (< 768px)"
    - "Sidebar shows on tablet/desktop (>= 768px)"
    - "Bottom nav has Messages, Contacts, Settings buttons"
    - "Active route is highlighted in bottom nav"
  artifacts:
    - path: "frontend/src/components/mobile/BottomNav.tsx"
      provides: "Mobile bottom navigation component"
      exports: ["BottomNav"]
    - path: "frontend/src/components/layout/AppShell.tsx"
      provides: "Responsive layout shell"
      contains: "useBreakpoint"
  key_links:
    - from: "frontend/src/components/layout/AppShell.tsx"
      to: "frontend/src/hooks/useBreakpoint.ts"
      via: "hook import and conditional rendering"
      pattern: "useBreakpoint.*isMobile.*BottomNav"
---

<objective>
Create mobile bottom navigation and update AppShell for responsive layout.

Purpose: Provide mobile-friendly navigation that replaces sidebar on small screens.
Output: BottomNav component and responsive AppShell that switches navigation based on breakpoint.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-ui-polish-production-readiness/04-CONTEXT.md
@frontend/src/components/layout/AppShell.tsx
@frontend/src/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BottomNav component</name>
  <files>frontend/src/components/mobile/BottomNav.tsx</files>
  <action>
    Create mobile bottom navigation at frontend/src/components/mobile/BottomNav.tsx.

    Design requirements from CONTEXT.md:
    - Fixed to bottom of screen
    - Show on mobile only (md:hidden)
    - Four nav items: Messages, Contacts, Settings (matching Sidebar)
    - No logout button (user accesses via Settings on mobile)

    Implementation:
    ```tsx
    import { Link, useLocation } from 'react-router'
    import { MessageCircle, Users, Settings } from 'lucide-react'
    import { cn } from '@/lib/utils'

    const navItems = [
      { href: '/messages', icon: MessageCircle, label: 'Messages' },
      { href: '/contacts', icon: Users, label: 'Contacts' },
      { href: '/settings', icon: Settings, label: 'Settings' },
    ]

    export function BottomNav() {
      const location = useLocation()

      return (
        <nav className="fixed bottom-0 left-0 right-0 bg-card border-t border-border md:hidden z-50">
          <div className="flex justify-around py-2 pb-safe">
            {navItems.map((item) => {
              const Icon = item.icon
              const isActive = location.pathname.startsWith(item.href)
              return (
                <Link
                  key={item.href}
                  to={item.href}
                  className={cn(
                    'flex flex-col items-center gap-1 px-4 py-2 rounded-lg transition-colors',
                    'hover:bg-accent',
                    isActive && 'text-primary'
                  )}
                >
                  <Icon className="h-5 w-5" />
                  <span className="text-xs">{item.label}</span>
                </Link>
              )
            })}
          </div>
        </nav>
      )
    }
    ```

    Add pb-safe for iOS safe area (needs tailwind config or use env(safe-area-inset-bottom)).
    For now, use pb-4 as a safe fallback.
  </action>
  <verify>TypeScript compiles: cd frontend && npx tsc --noEmit</verify>
  <done>BottomNav component with Messages, Contacts, Settings navigation</done>
</task>

<task type="auto">
  <name>Task 2: Update AppShell for responsive layout</name>
  <files>frontend/src/components/layout/AppShell.tsx</files>
  <action>
    Modify AppShell.tsx to conditionally render Sidebar or BottomNav based on breakpoint.

    Changes:
    1. Import useBreakpoint from '@/hooks/useBreakpoint'
    2. Import BottomNav from '@/components/mobile/BottomNav'
    3. Use isMobile to conditionally render:
       - Desktop/tablet: Show Sidebar (existing)
       - Mobile: Show BottomNav, hide Sidebar
    4. Add bottom padding to main content on mobile to account for BottomNav

    Updated structure:
    ```tsx
    import { useBreakpoint } from '@/hooks/useBreakpoint'
    import { BottomNav } from '@/components/mobile/BottomNav'

    export function AppShell({ children }: AppShellProps) {
      const { isMobile } = useBreakpoint()
      // ... existing call state logic ...

      return (
        <>
          {/* Call banners/windows remain the same */}
          {showIncomingCall && <IncomingCallBanner ... />}
          {showActiveCall && <ActiveCallWindow ... />}

          <div className="flex h-screen overflow-hidden">
            {/* Sidebar only on desktop/tablet */}
            {!isMobile && <Sidebar />}

            {/* Main content with bottom padding on mobile for nav */}
            <main className={cn(
              "flex-1 overflow-auto bg-background",
              isMobile && "pb-16" // Space for bottom nav
            )}>
              {children}
            </main>
          </div>

          {/* Bottom nav only on mobile */}
          {isMobile && <BottomNav />}
        </>
      )
    }
    ```

    Keep all existing call-related logic (IncomingCallBanner, ActiveCallWindow) unchanged.
    Just add the responsive navigation switching.
  </action>
  <verify>cd frontend && npm run build (compiles and builds successfully)</verify>
  <done>AppShell conditionally renders Sidebar/BottomNav based on screen size</done>
</task>

</tasks>

<verification>
1. cd frontend && npx tsc --noEmit
2. grep -l "BottomNav" frontend/src/components/mobile/BottomNav.tsx
3. grep "useBreakpoint" frontend/src/components/layout/AppShell.tsx
4. grep "isMobile" frontend/src/components/layout/AppShell.tsx
</verification>

<success_criteria>
- BottomNav component created with three nav items
- AppShell uses useBreakpoint to switch between Sidebar and BottomNav
- Mobile layout shows bottom nav, desktop shows sidebar
- Existing call functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish-production-readiness/04-03-SUMMARY.md`
</output>
