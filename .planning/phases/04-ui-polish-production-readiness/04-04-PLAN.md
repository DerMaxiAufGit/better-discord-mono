---
phase: 04-ui-polish-production-readiness
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/pages/MessagesPage.tsx
  - frontend/src/components/messaging/ConversationView.tsx
  - frontend/src/components/messaging/MessageInput.tsx
autonomous: true

must_haves:
  truths:
    - "Conversation view is full-screen on mobile"
    - "Back button appears on mobile to return to conversation list"
    - "Message input auto-grows up to ~4 lines then scrolls"
    - "Swipe gestures work on messages (swipe left for actions)"
  artifacts:
    - path: "frontend/src/pages/MessagesPage.tsx"
      provides: "Responsive messages page"
      contains: "isMobile"
    - path: "frontend/src/components/messaging/ConversationView.tsx"
      provides: "Mobile-optimized conversation view with back button"
      contains: "onBack"
    - path: "frontend/src/components/messaging/MessageInput.tsx"
      provides: "Auto-growing message input"
      contains: "textarea"
  key_links:
    - from: "frontend/src/pages/MessagesPage.tsx"
      to: "frontend/src/hooks/useBreakpoint.ts"
      via: "conditional layout rendering"
      pattern: "isMobile.*selectedContact"
---

<objective>
Make conversation view mobile-friendly with full-screen mode, back navigation, and improved input.

Purpose: Provide native-feeling messaging experience on mobile devices.
Output: Full-screen conversation on mobile with back button, auto-growing message input, and swipe gestures.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-ui-polish-production-readiness/04-CONTEXT.md
@frontend/src/pages/MessagesPage.tsx
@frontend/src/components/messaging/ConversationView.tsx
@frontend/src/components/messaging/MessageInput.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update MessagesPage for mobile full-screen conversation</name>
  <files>frontend/src/pages/MessagesPage.tsx</files>
  <action>
    Modify MessagesPage to show full-screen conversation on mobile.

    Current behavior: Side-by-side conversation list and view.
    New behavior on mobile:
    - When no conversation selected: Show conversation list full-width
    - When conversation selected: Show conversation view full-screen, hide list

    Implementation:
    1. Import useBreakpoint from '@/hooks/useBreakpoint'
    2. Add isMobile detection
    3. Conditionally render based on isMobile and selectedContactId:

    ```tsx
    const { isMobile } = useBreakpoint()

    // Mobile: show one or the other
    if (isMobile) {
      if (selectedContactId) {
        return (
          <div className="h-full">
            <ConversationView
              {...conversationProps}
              onBack={() => setSelectedContactId(null)}
            />
          </div>
        )
      }
      return (
        <div className="h-full">
          <ConversationList
            conversations={conversations}
            selectedId={selectedContactId}
            onSelect={handleSelectConversation}
          />
        </div>
      )
    }

    // Desktop: side-by-side (existing layout)
    return (
      <div className="flex h-full">
        <div className="w-80 border-r">
          <ConversationList ... />
        </div>
        <div className="flex-1">
          {selectedContactId ? <ConversationView ... /> : <EmptyState />}
        </div>
      </div>
    )
    ```

    Add onBack prop to ConversationView for mobile navigation.
  </action>
  <verify>TypeScript compiles: cd frontend && npx tsc --noEmit</verify>
  <done>MessagesPage shows full-screen conversation on mobile with navigation</done>
</task>

<task type="auto">
  <name>Task 2: Add back button to ConversationView</name>
  <files>frontend/src/components/messaging/ConversationView.tsx</files>
  <action>
    Update ConversationView to support mobile back navigation.

    Changes:
    1. Add optional onBack prop to interface
    2. Add back button to header when onBack is provided
    3. Import ArrowLeft icon from lucide-react

    Updated header:
    ```tsx
    interface ConversationViewProps {
      // ... existing props
      onBack?: () => void  // Called when back button clicked (mobile)
    }

    // In header section:
    <div className="h-[73px] flex items-center gap-3 px-4 border-b flex-shrink-0">
      {onBack && (
        <Button variant="ghost" size="icon" onClick={onBack}>
          <ArrowLeft className="h-5 w-5" />
        </Button>
      )}
      <Avatar fallback={contactUsername} className="h-10 w-10" />
      {/* ... rest of header */}
    </div>
    ```

    The back button only shows when onBack prop is provided (mobile mode).
  </action>
  <verify>TypeScript compiles: cd frontend && npx tsc --noEmit</verify>
  <done>ConversationView shows back button when onBack prop provided</done>
</task>

<task type="auto">
  <name>Task 3: Create auto-growing MessageInput</name>
  <files>frontend/src/components/messaging/MessageInput.tsx</files>
  <action>
    Update MessageInput to use auto-growing textarea instead of fixed input.

    Requirements from CONTEXT.md:
    - Auto-grow to reasonable height (~4 lines)
    - Then scroll within the textarea
    - Still submit on Enter (Shift+Enter for newline)

    Implementation:
    1. Change from input to textarea
    2. Use useRef to get textarea element
    3. On input change, reset height to auto, then set to scrollHeight
    4. Cap at max-height (around 120px for ~4 lines)
    5. Handle Enter key for submit, Shift+Enter for newline

    ```tsx
    import { useRef, useState, KeyboardEvent, useEffect } from 'react'

    export function MessageInput({ onSend, disabled, placeholder }: Props) {
      const [message, setMessage] = useState('')
      const textareaRef = useRef<HTMLTextAreaElement>(null)

      // Auto-resize textarea
      useEffect(() => {
        const textarea = textareaRef.current
        if (textarea) {
          textarea.style.height = 'auto'
          textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px'
        }
      }, [message])

      const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault()
          handleSubmit()
        }
      }

      const handleSubmit = () => {
        if (message.trim() && !disabled) {
          onSend(message.trim())
          setMessage('')
        }
      }

      return (
        <div className="p-4 border-t">
          <div className="flex gap-2">
            <textarea
              ref={textareaRef}
              value={message}
              onChange={(e) => setMessage(e.target.value)}
              onKeyDown={handleKeyDown}
              disabled={disabled}
              placeholder={placeholder}
              rows={1}
              className="flex-1 resize-none rounded-lg border bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-ring max-h-[120px] overflow-y-auto"
            />
            <Button onClick={handleSubmit} disabled={disabled || !message.trim()}>
              <Send className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )
    }
    ```
  </action>
  <verify>cd frontend && npm run build (compiles successfully)</verify>
  <done>MessageInput auto-grows up to 4 lines then scrolls</done>
</task>

</tasks>

<verification>
1. cd frontend && npx tsc --noEmit
2. grep "onBack" frontend/src/components/messaging/ConversationView.tsx
3. grep "textarea" frontend/src/components/messaging/MessageInput.tsx
4. grep "isMobile" frontend/src/pages/MessagesPage.tsx
</verification>

<success_criteria>
- MessagesPage shows full-screen conversation on mobile
- Back button appears in ConversationView header on mobile
- MessageInput uses auto-growing textarea
- Keyboard behavior: Enter sends, Shift+Enter adds newline
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish-production-readiness/04-04-SUMMARY.md`
</output>
