---
phase: 05-enhanced-communication
plan: 14
type: execute
wave: 4
depends_on: ["05-09"]
files_modified:
  - frontend/src/components/typing/TypingIndicator.tsx
  - frontend/src/components/messaging/MessageReply.tsx
autonomous: true

must_haves:
  truths:
    - "Typing indicator shows animated dots with user name"
    - "Multiple typing users formatted correctly"
    - "Message replies show quoted message preview"
  artifacts:
    - path: "frontend/src/components/typing/TypingIndicator.tsx"
      provides: "Typing indicator display"
      exports: ["TypingIndicator"]
    - path: "frontend/src/components/messaging/MessageReply.tsx"
      provides: "Reply quote component"
      exports: ["MessageReply", "ReplyPreview"]
  key_links:
    - from: "TypingIndicator.tsx"
      to: "useTypingIndicator"
      via: "formatTypingIndicator"
      pattern: "formatTypingIndicator"
---

<objective>
Create typing indicator UI and message reply components.

Purpose: Show real-time typing status and enable inline message replies
Output: Typing indicator and reply UI for enhanced messaging
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-enhanced-communication/05-RESEARCH.md
@.planning/phases/05-enhanced-communication/05-09-SUMMARY.md
@frontend/src/hooks/useTypingIndicator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create typing indicator component</name>
  <files>frontend/src/components/typing/TypingIndicator.tsx</files>
  <action>
Create frontend/src/components/typing/ directory and TypingIndicator.tsx:

```typescript
import { formatTypingIndicator } from '@/hooks/useTypingIndicator'
import { cn } from '@/lib/utils'

interface TypingUser {
  userId: string
  email?: string
}

interface TypingIndicatorProps {
  users: TypingUser[]
  className?: string
}

export function TypingIndicator({ users, className }: TypingIndicatorProps) {
  if (users.length === 0) return null

  const text = formatTypingIndicator(users)

  return (
    <div className={cn('flex items-center gap-2 text-sm text-gray-400', className)}>
      <TypingDots />
      <span>{text}</span>
    </div>
  )
}

// Animated dots component
function TypingDots() {
  return (
    <div className="flex items-center gap-0.5">
      <span
        className="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"
        style={{ animationDelay: '0ms' }}
      />
      <span
        className="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"
        style={{ animationDelay: '150ms' }}
      />
      <span
        className="w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce"
        style={{ animationDelay: '300ms' }}
      />
    </div>
  )
}

// Inline typing indicator for conversation view
export function InlineTypingIndicator({
  users
}: {
  users: TypingUser[]
}) {
  if (users.length === 0) return null

  return (
    <div className="px-4 py-2">
      <TypingIndicator users={users} />
    </div>
  )
}

// Compact typing indicator for conversation list item
export function CompactTypingIndicator({
  isTyping
}: {
  isTyping: boolean
}) {
  if (!isTyping) return null

  return (
    <span className="text-blue-400 text-xs flex items-center gap-1">
      <TypingDots />
      <span>typing</span>
    </span>
  )
}
```

Add the bounce animation to index.css if not already present:

```css
@keyframes bounce {
  0%, 60%, 100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-4px);
  }
}

.animate-bounce {
  animation: bounce 1s infinite;
}
```
  </action>
  <verify>Run: cd frontend && npx tsc --noEmit</verify>
  <done>TypingIndicator.tsx shows animated dots with formatted text</done>
</task>

<task type="auto">
  <name>Task 2: Create message reply components</name>
  <files>frontend/src/components/messaging/MessageReply.tsx</files>
  <action>
Create MessageReply.tsx:

```typescript
import { cn } from '@/lib/utils'

interface ReplyMessage {
  id: number
  content: string
  senderEmail: string
}

interface MessageReplyProps {
  replyTo: ReplyMessage
  onClick?: () => void
  className?: string
}

// Displayed on a message that is a reply
export function MessageReply({ replyTo, onClick, className }: MessageReplyProps) {
  const senderName = replyTo.senderEmail.split('@')[0]
  const preview = replyTo.content.length > 100
    ? replyTo.content.slice(0, 100) + '...'
    : replyTo.content

  return (
    <div
      onClick={onClick}
      className={cn(
        'flex items-start gap-2 pl-3 border-l-2 border-gray-600 mb-1 cursor-pointer hover:bg-gray-800/50 rounded-r py-1',
        className
      )}
    >
      <svg className="w-4 h-4 text-gray-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>
      <div className="min-w-0 flex-1">
        <span className="text-xs font-medium text-blue-400">{senderName}</span>
        <p className="text-xs text-gray-500 truncate">{preview}</p>
      </div>
    </div>
  )
}

// Preview shown in message input when replying
interface ReplyPreviewProps {
  replyTo: ReplyMessage
  onCancel: () => void
  className?: string
}

export function ReplyPreview({ replyTo, onCancel, className }: ReplyPreviewProps) {
  const senderName = replyTo.senderEmail.split('@')[0]
  const preview = replyTo.content.length > 60
    ? replyTo.content.slice(0, 60) + '...'
    : replyTo.content

  return (
    <div className={cn(
      'flex items-center gap-2 px-3 py-2 bg-gray-800 border-l-4 border-blue-500 rounded-t-lg',
      className
    )}>
      <svg className="w-4 h-4 text-blue-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>

      <div className="flex-1 min-w-0">
        <span className="text-xs font-medium text-blue-400">
          Replying to {senderName}
        </span>
        <p className="text-sm text-gray-400 truncate">{preview}</p>
      </div>

      <button
        onClick={onCancel}
        className="p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors"
        title="Cancel reply"
      >
        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  )
}

// Reply button for message hover actions
export function ReplyButton({
  onClick,
  className
}: {
  onClick: () => void
  className?: string
}) {
  return (
    <button
      onClick={onClick}
      className={cn(
        'p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors',
        className
      )}
      title="Reply"
    >
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>
    </button>
  )
}
```
  </action>
  <verify>Run: cd frontend && npx tsc --noEmit</verify>
  <done>MessageReply.tsx exports reply display and preview components</done>
</task>

<task type="auto">
  <name>Task 3: Add CSS animations for typing indicator</name>
  <files>frontend/src/index.css</files>
  <action>
Ensure index.css has the bounce animation for typing dots. Add if not present:

```css
/* Typing indicator animation */
@keyframes typing-bounce {
  0%, 60%, 100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-4px);
  }
}

.animate-typing-bounce {
  animation: typing-bounce 1s infinite;
}

/* Alternative using existing bounce if available */
```

Also update TypingIndicator to use the custom class if the default animate-bounce doesn't stagger properly.
  </action>
  <verify>Run: cd frontend && npm run build (verify CSS compiles)</verify>
  <done>CSS animation defined for typing indicator dots</done>
</task>

</tasks>

<verification>
1. Frontend TypeScript compiles
2. TypingIndicator shows animated dots
3. formatTypingIndicator handles 1, 2, and 3+ users
4. MessageReply shows quoted content with sender name
5. ReplyPreview appears above message input with cancel button
</verification>

<success_criteria>
- Dots animate with staggered delay
- "Name is typing..." format for single user
- "Name and Name are typing..." for two users
- "3 people are typing..." for three+ users
- Reply shows truncated preview of original message
- Cancel button clears reply state
</success_criteria>

<output>
After completion, create `.planning/phases/05-enhanced-communication/05-14-SUMMARY.md`
</output>
