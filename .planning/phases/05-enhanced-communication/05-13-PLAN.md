---
phase: 05-enhanced-communication
plan: 13
type: execute
wave: 4
depends_on: ["05-09"]
files_modified:
  - frontend/src/components/reactions/ReactionPicker.tsx
  - frontend/src/components/reactions/QuickReactions.tsx
  - frontend/src/components/reactions/ReactionList.tsx
autonomous: true

must_haves:
  truths:
    - "Emoji picker opens with search and category navigation"
    - "Quick reactions show 6 common emoji for fast access"
    - "Reaction list shows users who reacted on hover"
  artifacts:
    - path: "frontend/src/components/reactions/ReactionPicker.tsx"
      provides: "Full emoji picker"
      exports: ["ReactionPicker"]
    - path: "frontend/src/components/reactions/QuickReactions.tsx"
      provides: "Quick reaction bar"
      exports: ["QuickReactions"]
    - path: "frontend/src/components/reactions/ReactionList.tsx"
      provides: "Reaction display with user list"
      exports: ["ReactionList"]
  key_links:
    - from: "ReactionPicker.tsx"
      to: "emoji-picker-react"
      via: "import"
      pattern: "import.*EmojiPicker"
    - from: "QuickReactions.tsx"
      to: "reactionStore"
      via: "toggleReaction"
      pattern: "toggleReaction"
---

<objective>
Create reaction UI components for emoji picker and reaction display.

Purpose: Enable emoji reactions on messages with quick access and full picker
Output: Complete reaction workflow from selection to display
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-enhanced-communication/05-RESEARCH.md
@.planning/phases/05-enhanced-communication/05-09-SUMMARY.md
@frontend/src/stores/reactionStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reaction picker component</name>
  <files>frontend/src/components/reactions/ReactionPicker.tsx</files>
  <action>
Create frontend/src/components/reactions/ directory and ReactionPicker.tsx:

```typescript
import { useState, useRef, useEffect } from 'react'
import EmojiPicker, { EmojiClickData, Theme } from 'emoji-picker-react'
import { useTheme } from 'next-themes'
import { cn } from '@/lib/utils'

interface ReactionPickerProps {
  onSelect: (emoji: string) => void
  onClose: () => void
  position?: 'top' | 'bottom'
  align?: 'left' | 'right' | 'center'
}

export function ReactionPicker({
  onSelect,
  onClose,
  position = 'top',
  align = 'left'
}: ReactionPickerProps) {
  const { theme } = useTheme()
  const containerRef = useRef<HTMLDivElement>(null)

  // Close on click outside
  useEffect(() => {
    const handleClickOutside = (e: MouseEvent) => {
      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {
        onClose()
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [onClose])

  // Close on escape
  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        onClose()
      }
    }

    document.addEventListener('keydown', handleEscape)
    return () => document.removeEventListener('keydown', handleEscape)
  }, [onClose])

  const handleEmojiClick = (emojiData: EmojiClickData) => {
    onSelect(emojiData.emoji)
    onClose()
  }

  const positionClasses = {
    top: 'bottom-full mb-2',
    bottom: 'top-full mt-2'
  }

  const alignClasses = {
    left: 'left-0',
    right: 'right-0',
    center: 'left-1/2 -translate-x-1/2'
  }

  return (
    <div
      ref={containerRef}
      className={cn(
        'absolute z-50',
        positionClasses[position],
        alignClasses[align]
      )}
    >
      <EmojiPicker
        onEmojiClick={handleEmojiClick}
        theme={theme === 'dark' ? Theme.DARK : Theme.LIGHT}
        emojiStyle="twitter"
        width="350px"
        height="400px"
        searchPlaceHolder="Search emoji..."
        previewConfig={{ showPreview: false }}
        skinTonesDisabled
      />
    </div>
  )
}

// Trigger button that opens picker
export function ReactionPickerTrigger({
  onOpenPicker,
  className
}: {
  onOpenPicker: () => void
  className?: string
}) {
  return (
    <button
      onClick={onOpenPicker}
      className={cn(
        'p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors',
        className
      )}
      title="Add reaction"
    >
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          strokeLinecap="round"
          strokeLinejoin="round"
          strokeWidth={2}
          d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        />
      </svg>
    </button>
  )
}
```
  </action>
  <verify>Run: cd frontend && npx tsc --noEmit</verify>
  <done>ReactionPicker.tsx exports picker and trigger button</done>
</task>

<task type="auto">
  <name>Task 2: Create quick reactions component</name>
  <files>frontend/src/components/reactions/QuickReactions.tsx</files>
  <action>
Create QuickReactions.tsx:

```typescript
import { useState } from 'react'
import { useReactionStore, ReactionSummary } from '@/stores/reactionStore'
import { ReactionPicker } from './ReactionPicker'
import { cn } from '@/lib/utils'

// Default quick reaction emoji (user customizable in future)
const DEFAULT_QUICK_REACTIONS = ['ðŸ‘', 'â¤ï¸', 'ðŸ˜‚', 'ðŸ˜®', 'ðŸ˜¢', 'ðŸ™']

interface QuickReactionsProps {
  messageId: number
  onReact: (emoji: string) => Promise<void>
  className?: string
}

export function QuickReactions({
  messageId,
  onReact,
  className
}: QuickReactionsProps) {
  const [showPicker, setShowPicker] = useState(false)
  const [isReacting, setIsReacting] = useState(false)
  const reactions = useReactionStore((s) => s.reactions.get(messageId) || [])

  // Load quick reactions from localStorage or use defaults
  const quickReactions = (() => {
    try {
      const saved = localStorage.getItem('quick-reactions')
      return saved ? JSON.parse(saved) : DEFAULT_QUICK_REACTIONS
    } catch {
      return DEFAULT_QUICK_REACTIONS
    }
  })()

  const handleReact = async (emoji: string) => {
    if (isReacting) return
    setIsReacting(true)
    try {
      await onReact(emoji)
    } finally {
      setIsReacting(false)
    }
  }

  const hasReacted = (emoji: string) =>
    reactions.some(r => r.emoji === emoji && r.userReacted)

  return (
    <div className={cn('relative inline-flex items-center gap-1 bg-gray-800 rounded-full px-2 py-1', className)}>
      {quickReactions.map((emoji: string) => (
        <button
          key={emoji}
          onClick={() => handleReact(emoji)}
          disabled={isReacting}
          className={cn(
            'text-lg p-1 rounded-full hover:bg-gray-700 transition-colors',
            hasReacted(emoji) && 'bg-blue-600/30'
          )}
          title={emoji}
        >
          {emoji}
        </button>
      ))}

      {/* More emoji button */}
      <button
        onClick={() => setShowPicker(true)}
        className="p-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded-full transition-colors"
        title="More reactions"
      >
        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg>
      </button>

      {showPicker && (
        <ReactionPicker
          onSelect={handleReact}
          onClose={() => setShowPicker(false)}
          position="top"
          align="right"
        />
      )}
    </div>
  )
}

// Hover overlay for messages
export function MessageReactionOverlay({
  messageId,
  onReact,
  show
}: {
  messageId: number
  onReact: (emoji: string) => Promise<void>
  show: boolean
}) {
  if (!show) return null

  return (
    <div className="absolute -top-2 right-0 translate-y-[-100%]">
      <QuickReactions messageId={messageId} onReact={onReact} />
    </div>
  )
}
```
  </action>
  <verify>Run: cd frontend && npx tsc --noEmit</verify>
  <done>QuickReactions.tsx shows 6 quick emoji with toggle state</done>
</task>

<task type="auto">
  <name>Task 3: Create reaction list component</name>
  <files>frontend/src/components/reactions/ReactionList.tsx</files>
  <action>
Create ReactionList.tsx:

```typescript
import { useState } from 'react'
import { ReactionSummary } from '@/stores/reactionStore'
import { cn } from '@/lib/utils'

interface ReactionListProps {
  reactions: ReactionSummary[]
  onToggle: (emoji: string) => Promise<void>
  compact?: boolean
  className?: string
}

export function ReactionList({
  reactions,
  onToggle,
  compact = false,
  className
}: ReactionListProps) {
  const [hoveredEmoji, setHoveredEmoji] = useState<string | null>(null)
  const [isToggling, setIsToggling] = useState(false)

  if (reactions.length === 0) return null

  const handleToggle = async (emoji: string) => {
    if (isToggling) return
    setIsToggling(true)
    try {
      await onToggle(emoji)
    } finally {
      setIsToggling(false)
    }
  }

  return (
    <div className={cn('flex flex-wrap gap-1', className)}>
      {reactions.map((reaction) => (
        <div key={reaction.emoji} className="relative">
          <button
            onClick={() => handleToggle(reaction.emoji)}
            onMouseEnter={() => setHoveredEmoji(reaction.emoji)}
            onMouseLeave={() => setHoveredEmoji(null)}
            disabled={isToggling}
            className={cn(
              'inline-flex items-center gap-1 rounded-full transition-colors',
              compact
                ? 'px-1.5 py-0.5 text-xs'
                : 'px-2 py-1 text-sm',
              reaction.userReacted
                ? 'bg-blue-600/30 hover:bg-blue-600/40 text-blue-400'
                : 'bg-gray-800 hover:bg-gray-700 text-gray-300'
            )}
          >
            <span>{reaction.emoji}</span>
            <span className={cn(
              'font-medium',
              reaction.userReacted ? 'text-blue-400' : 'text-gray-500'
            )}>
              {reaction.count}
            </span>
          </button>

          {/* User list tooltip */}
          {hoveredEmoji === reaction.emoji && reaction.users.length > 0 && (
            <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-1 z-50">
              <div className="bg-gray-900 border border-gray-700 rounded-lg shadow-xl px-3 py-2 whitespace-nowrap">
                <div className="text-xs text-gray-400 mb-1">
                  {reaction.emoji} {reaction.count}
                </div>
                <div className="space-y-0.5">
                  {reaction.users.slice(0, 10).map((user) => (
                    <div key={user.userId} className="text-sm">
                      {user.email.split('@')[0]}
                    </div>
                  ))}
                  {reaction.users.length > 10 && (
                    <div className="text-xs text-gray-500">
                      and {reaction.users.length - 10} more
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      ))}
    </div>
  )
}

// Compact inline reaction display for message list
export function InlineReactions({
  reactions,
  onToggle
}: {
  reactions: ReactionSummary[]
  onToggle: (emoji: string) => Promise<void>
}) {
  return (
    <ReactionList
      reactions={reactions}
      onToggle={onToggle}
      compact
      className="mt-1"
    />
  )
}
```
  </action>
  <verify>Run: cd frontend && npx tsc --noEmit</verify>
  <done>ReactionList.tsx shows reactions with hover tooltip</done>
</task>

</tasks>

<verification>
1. Frontend TypeScript compiles
2. ReactionPicker uses emoji-picker-react with Twemoji
3. QuickReactions shows 6 default emoji
4. ReactionList shows count and user list on hover
</verification>

<success_criteria>
- Emoji picker has search and categories
- Quick reactions highlight when user has reacted
- Reaction badges show count
- Hover reveals list of users who reacted
- Click toggles reaction on/off
</success_criteria>

<output>
After completion, create `.planning/phases/05-enhanced-communication/05-13-SUMMARY.md`
</output>
